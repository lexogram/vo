<!DOCTYPE html>
<html lang=ru>

<head>
  <meta charset="utf-8">
  <title>Разгоров</title>

  <style>
    video::cue {
     color: #fff;
    }

    span.highlight {
      color: #fff;
      background-color: #000;
    }
  </style>
</head>

<body>
<figure id="videoContainer">
   <video
    id="video"
    controls
    preload="metadata"
    poster="img/poster.jpg">

     <!--  <source src="video/video.mp4"
       type="video/mp4"> -->
      <source src="video/video.webm"
       type="video/webm">
      <source src="video/video.ogv"
       type="video/ogg">

      <!-- Flash fallback -->
      <object type="application/x-shockwave-flash" data="flash-player.swf?videoUrl=video/video.mp4" width="720" height="480">
         <param name="movie" value="flash-player.swf?videoUrl=video/video.mp4" />
         <param name="allowfullscreen" value="true" />
         <param name="wmode" value="transparent" />
         <param name="flashvars" value="controlbar=over&amp;image=img/poster.jpg&amp;file=flash-player.swf?videoUrl=video/video.mp4" />

         <img
          alt="Разгоров"
          src="img/poster.jpg"
          width="720"
          height="480"
          title="No video playback possible, please download the video from the link below"
         />
      </object>
      <!-- Offer download -->
      <a href="video/video.mp4">Download MP4</a>
   
    <track
     label="Русский"
     kind="subtitles"
     srclang="ru"
     src="captions/ru.vtt"
     default
    >
    <track
     label="UK English"
     kind="subtitles"
     srclang="en-GB"
     src="captions/en.vtt"
    >
    <track
     label="Français"
     kind="subtitles"
     srclang="fr"
     src="captions/fr.vtt"
    >

   </video>
   <figcaption>&copy; 2017 Анастасия Антонова</figcaption>
</figure>

<div>
  <p><span>Привет!</span></p>

  <p><span>Я запишу на видео твой рассказ
  "Разговор".</span>

  <span>Сначала я прочитаю его медленно,</span>

  <span>а потом в естественном темпе.</span></p>

  <p><span>Кем Вы работаете?</span></p>

  <p><span>Я - генный инженер.</span></p>

  <p><span>Вы создаёте семена генетически
  модифицированных продуктов?</span></p>

  <p><span>Нет, я разрабатываю семена
  для швейной промышленности.</span>

  <span>Моя команда извлекла ДНК
  из футболок,</span>

  <span>и мы ввели специфические
  гены в ДНК хлопка</span>

  <span>и теперь футболки растут
  прямо на хлопчатнике.</span></p>

  <p><span>Неужели?</span></p>

  <p><span>Вскоре Вы сможете выращивать
  собственные футболки на дому.</span>

  <span>Они просто растут сами по себе,</span>

  <span>пока не достигнут нужного размера,</span>

  <span>а потом Вы можете их сорвать.</span></p>

  <p><span>Футболки могут быть
  только одного цвета?</span>

  <span>Или они могут быть с авторским дизайном?</span></p>

  <p><span>На данный момент - только одного,</span>

  <span>но Вы можете выбрать цвет,</span>

  <span>добавив тот или иной пигмент к воде,</span>

  <span>которой Вы поливаете хлопчатник.</span></p>

  <p><span>А как насчёт Вас?</span>

  <span>Что у Вас за работа?</span></p>

  <p><span>Я - улиточный фермер.</span></p>

  <p><span>Здорово!</span></p>

  <p><span>Мне кажется,</span>

  <span>у меня не совсем получилось записать медленно,</span>

  <span>но сейчас я прочитаю, как</span>

  <span>читала бы его сама.</span></p>

  <p><span>Кем Вы работаете?</span></p>

  <p><span>Я - генный инженер.</span></p>

  <p><span>Вы создаёте семена генетически
  модифицированных продуктов?</span></p>

  <p><span>Нет, я разрабатываю семена
  для швейной промышленности.</span>

  <span>Моя команда извлекла ДНК
  из футболок,</span>

  <span>и мы ввели специфические
  гены в ДНК хлопка</span>

  <span>и теперь футболки растут
  прямо на хлопчатнике.</span></p>

  <p><span>Неужели?</span></p>

  <p><span>Вскоре Вы сможете выращивать
  собственные футболки на дому.</span>

  <span>Они просто растут сами по себе,</span>

  <span>пока не достигнут нужного размера,</span>

  <span>а потом Вы можете их сорвать.</span></p>

  <p><span>Футболки могут быть
  только одного цвета?</span>

  <span>Или они могут быть с авторским дизайном?</span></p>

  <p><span>На данный момент - только одного,</span>

  <span>но Вы можете выбрать цвет,</span>

  <span>добавив тот или иной пигмент к воде,</span>

  <span>которой Вы поливаете хлопчатник.</span></p>

  <p><span>А как насчёт Вас?</span>

  <span>Что у Вас за работа?</span></p>

  <p><span>Я - улиточный фермер.</span></p>

  <p><span>Здорово!</span></p>
</div>

<script>
;(function () {
  var cueSpans = []
  var tracks = document.querySelectorAll("track")
  var startTimeMap = []
  var lastSpan

  var total = tracks.length
  var ii
    , track

  createCueSpans()

  function createCueSpans() {
    cueSpans = document.querySelectorAll("span")
    console.log(cueSpans)
  }

  // document.querySelector("div").onmouseup = function() {
  //   var index = Math.floor(Math.random() * startTimeMap.length)
  //   var time = startTimeMap[index]
  //   showCueChange.apply({activeCues: [{startTime: time}]})
  // }

  function showCueChange() {    
    var startTime = this.activeCues[0].startTime
    var index = startTimeMap.indexOf(startTime)

    /* Manually setting the selection breaks the subtitle menu in
       Chrome and Opera (webkit browsers). Set a class on the span
       instead.
     */
    
    if (lastSpan) {
      lastSpan.classList.remove("highlight")
    }
    lastSpan = cueSpans[index]
    lastSpan.classList.add("highlight")

    // var sel = window.getSelection()
    // var range = document.createRange()

    // range.selectNodeContents(lastSpan)
    // sel.removeAllRanges()
    // sel.addRange(range)
  }
  
  for (ii = 0; ii < total; ii += 1) {
    track = tracks[ii]
    track.track.oncuechange = showCueChange
    track.onload = createStartTimeMap
  }

  createCueSpans()

  function createCueSpans() {
    cueSpans = document.querySelectorAll("span")
    console.log(cueSpans)
  }

  function createStartTimeMap() {
    this.onload = null

    var cueList = this.track.cues
    var total
      , ii

    if (!startTimeMap.length && cueList) {
      total = cueList.length

      for (ii = 0; ii < total; ii += 1) {
       startTimeMap.push(cueList[ii].startTime)
      }
    }
  }
})()
</script>
</body>
</html>